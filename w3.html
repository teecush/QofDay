<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MX Daily Checkâ€‘In (Drag â€¢ Randomize â€¢ Presets)</title>
<style>
  :root{
    --bg:#0b1020; --panel:#0f172a; --ink:#e6eef8;
    --muted:#94a3b8; --stroke:#1f2937;
    --cyan:#22d3ee; --violet:#a78bfa; --green:#34d399; --amber:#fbbf24; --rose:#f87171;
    /* Pastel bins */
    --pastel-blue:#e3f2ff;   --pastel-blue-b:#90cdf4;
    --pastel-red:#ffe4e6;    --pastel-red-b:#fca5a5;
    --pastel-green:#e9fdf2;  --pastel-green-b:#86efac;
    --pastel-purple:#f3e8ff; --pastel-purple-b:#c4b5fd;
    --pastel-yellow:#fff7cc; --pastel-yellow-b:#fde68a;
  }
  html,body{height:100%;margin:0;background:radial-gradient(1200px 800px at 10% 0%, #0d1430, #0b1020 60%);color:var(--ink);font-family:Inter, ui-sans-serif, system-ui, Segoe UI, Roboto, Arial, sans-serif;}
  .app{display:grid;grid-template-rows:auto auto 1fr auto;gap:12px;height:100%;padding:16px;box-sizing:border-box}
  .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;background:rgba(15,23,42,.6);border:1px solid var(--stroke);border-radius:16px;padding:10px 12px;backdrop-filter:blur(6px)}
  .toolbar button,.toolbar input,.toolbar select{font-size:16px;border-radius:12px;border:1px solid #334155;background:#0b1226;color:var(--ink);padding:10px 14px}
  .toolbar input[type="text"]{min-width:240px}
  .toolbar button{cursor:pointer;box-shadow:0 0 0 1px #263142 inset}
  .toolbar button.primary{background:linear-gradient(90deg,var(--cyan),var(--violet));color:#0b1226;font-weight:800}
  .toolbar .split{flex:1}

  .question{font-size:clamp(22px,4vw,48px);font-weight:900;letter-spacing:.2px;margin:2px 4px}

  .board{display:grid;grid-template-columns:1fr;grid-template-rows:auto 1fr;gap:10px}
  .zones{display:grid;gap:12px;grid-template-columns:repeat(2,minmax(0,1fr));grid-auto-rows:minmax(160px,1fr)}
  @media (min-width:1100px){.zones{grid-template-columns:repeat(4,minmax(0,1fr));}}
  .zone{position:relative;border-radius:18px;border:2px dashed #94a3b8;padding:12px;box-shadow:0 12px 40px rgba(0,0,0,.25) inset}
  .zone h3{margin:0 0 8px 0;font-size:clamp(16px,2.2vw,28px);font-weight:900;color:#0b1020;text-shadow:0 1px 0 rgba(255,255,255,.6)}
  .zone.blue{background:var(--pastel-blue);border-color:var(--pastel-blue-b)}
  .zone.red{background:var(--pastel-red);border-color:var(--pastel-red-b)}
  .zone.green{background:var(--pastel-green);border-color:var(--pastel-green-b)}
  .zone.purple{background:var(--pastel-purple);border-color:var(--pastel-purple-b)}
  .zone.yellow{background:var(--pastel-yellow);border-color:var(--pastel-yellow-b)}

  .parking{background:#0b1226;border-radius:18px;border:1px solid var(--stroke);padding:10px}
  .parking h3{margin:0 0 6px;font-size:18px;font-weight:800;color:#cbd5e1}

  .badge{position:absolute;touch-action:none;user-select:none;display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;font-weight:800;font-size:clamp(14px,1.8vw,20px);color:#0b1226;background:linear-gradient(90deg,#eef2ff,#e2e8f0);box-shadow:0 8px 22px rgba(0,0,0,.45);border:2px solid #0f172a}
  .badge[data-absent="true"]{background:linear-gradient(90deg,#ffe4e6,#fecaca)}
  .badge .num{background:#0b1226;color:#a7f3d0;font-weight:900;font-size:.9em;padding:2px 8px;border-radius:999px}
  .badge.spinning{outline:4px solid var(--amber)}
  .badge.winner{outline:6px solid var(--green)}

  .footer{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .footer .stat{background:#0b1226;border:1px solid var(--stroke);border-radius:12px;padding:6px 10px}

  .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:50}
  .modal.show{display:flex}
  .sheet{width:min(980px,92vw);max-height:86vh;overflow:auto;background:#0b1226;border:1px solid var(--stroke);border-radius:16px;padding:16px;box-shadow:0 20px 60px rgba(0,0,0,.5)}
  .sheet h2{margin:0 0 10px}
  .sheet textarea,.sheet input,.sheet select{width:100%;min-height:44px;background:#0b1226;color:var(--ink);border:1px solid #334155;border-radius:12px;padding:10px;font-size:16px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}

  .toast{position:fixed;bottom:16px;right:16px;background:#0b1226;color:var(--ink);border:1px solid var(--stroke);border-radius:12px;padding:10px 14px;opacity:0;transform:translateY(8px);transition:.25s}
  .toast.show{opacity:1;transform:translateY(0)}
</style>
</head>
<body>
<div class="app" id="app">
  <div class="toolbar">
    <button id="editBtn">âœï¸ Edit</button>
    <button id="presetMood">ğŸŸ¦ğŸŸ¥ğŸŸ¨ğŸŸ© Mood Checker</button>
    <input id="keywordInput" type="text" placeholder="Keywords (e.g., friendship, patterns)" />
    <button id="genBtn">âœ¨ Generate Question</button>
    <span class="split"></span>
    <button id="randomBtn" class="primary">ğŸ¡ Pick Random Name</button>
    <button id="resetBtn">â†©ï¸ Reset positions</button>
    <button id="saveBtn">ğŸ’¾ Save layout</button>
    <button id="loadBtn">â­³ Load layout</button>
  </div>

  <div class="question" id="question">What did you eat for breakfast?</div>

  <div class="board">
    <div class="zones" id="zones">
      <div class="zone blue"   data-zone="0"><h3>ğŸ Toast</h3></div>
      <div class="zone red"    data-zone="1"><h3>ğŸ¥£ Cereal</h3></div>
      <div class="zone green"  data-zone="2"><h3>ğŸ³ Eggs</h3></div>
      <div class="zone purple" data-zone="3"><h3>ğŸ Fruit</h3></div>
    </div>
  </div>

  <div class="parking" id="parking">
    <h3>ğŸ…¿ï¸ Parking Lot / Absent</h3>
  </div>

  <div class="footer" id="footer">
    <span class="stat" id="statPlaced">Placed: 0</span>
    <span class="stat" id="statAbsent">Absent (not placed): 0</span>
  </div>
</div>

<!-- Edit Modal -->
<div class="modal" id="editModal">
  <div class="sheet">
    <h2>âœï¸ Edit Question & Choices</h2>
    <div class="row">
      <label style="min-width:140px">Question</label>
      <input id="qInput" placeholder="Type your daily question" />
    </div>
    <div style="height:8px"></div>
    <div class="row">
      <label style="min-width:140px">Number of choices</label>
      <select id="choiceCount">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4" selected>4</option>
      </select>
      <label><input type="checkbox" id="openMode"/> "Open" option (I'm ready to explain!)</label>
    </div>
    <div style="height:8px"></div>
    <label>Choices (one per line; emojis allowed)</label>
    <textarea id="choicesInput">ğŸ Toast
ğŸ¥£ Cereal
ğŸ³ Eggs
ğŸ Fruit</textarea>
    <div style="height:10px"></div>
    <div class="row">
      <button id="applyEdit">Apply</button>
      <button id="closeEdit">Close</button>
    </div>
  </div>
</div>

<!-- Roster Modal -->
<div class="modal" id="rosterModal">
  <div class="sheet">
    <h2>ğŸ‘¥ Edit roster</h2>
    <p>Enter one student per line.</p>
    <textarea id="rosterInput">Mr. Cushman
Abdallah
Robyn
Layla
Keerthy
Hakim
Melania
Halo
Abbas
Penelope
Harnoor
Sean
Su
Caleb
Elena
Selena
Anisha
Iris
Jazmine
Alayna
Shreyansh</textarea>
    <div style="height:10px"></div>
    <div class="row">
      <button id="applyRoster">Apply roster</button>
      <button id="closeRoster">Close</button>
    </div>
  </div>
</div>

<!-- Winner overlay -->
<div class="modal" id="winnerModal"><div class="sheet" style="text-align:center">
  <h2 id="winnerText" style="font-size:clamp(28px,4.8vw,60px); margin:0 0 8px"></h2>
  <div id="winnerSub" style="font-size:clamp(18px,2.4vw,30px); opacity:.9"></div>
  <div style="height:14px"></div>
  <button id="closeWinner">OK</button>
</div></div>

<div class="toast" id="toast"></div>

<script>
(function(){
  const $ = s=>document.querySelector(s);
  const $$ = s=>Array.from(document.querySelectorAll(s));

  const app = $('#app');
  const zonesEl = $('#zones');
  const parking = $('#parking');
  const questionEl = $('#question');
  const toast = $('#toast');

  let roster = [];
  let badges = [];
  let drag = null;

  const zoneColors = ["blue","red","green","purple"]; // 4 pastel colours
  const moodPreset = {
    q: 'What Zone are you in??',
    choices: [
      'ğŸ˜¢ Blue Zone', // low states
      'ğŸ˜¡ Red Zone',
      'ğŸ˜Š Yellow Zone',
      'ğŸ™‚ Green Zone'
    ],
    colors: ["blue","red","yellow","green"]
  };

  // --- Utilities ---
  function showToast(msg){ toast.textContent = msg; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 1500); }
  function rect(el){ return el.getBoundingClientRect(); }
  function center(el){ const r=rect(el); return {x:r.left+r.width/2, y:r.top+r.height/2}; }
  function within(p, el){ const r=rect(el); return p.x>=r.left && p.x<=r.right && p.y>=r.top && p.y<=r.bottom; }
  function save(key, val){ localStorage.setItem(key, JSON.stringify(val)); }
  function load(key, fallback){ try{ const v=JSON.parse(localStorage.getItem(key)); return v??fallback; }catch{ return fallback; } }

  // --- Builder functions ---
  function buildZones(choices, colors){
    zonesEl.innerHTML = '';
    const n = choices.length;
    for(let i=0;i<n;i++){
      const z = document.createElement('div');
      z.className = 'zone ' + (colors?.[i] || zoneColors[i%zoneColors.length]);
      z.dataset.zone = i;
      const h = document.createElement('h3');
      h.textContent = choices[i];
      z.appendChild(h);
      zonesEl.appendChild(z);
    }
  }

  function applyChoices(){
    const lines = $('#choicesInput').value.split(/\n+/).map(s=>s.trim()).filter(Boolean);
    const countSel = parseInt($('#choiceCount').value, 10) || 4;
    const open = $('#openMode').checked;

    let choices = lines.slice(0, countSel);
    if(open){ choices.push('ğŸ—£ï¸ I\'ve got my answer and I\'m ready to explain!'); }

    // set colours to four pastels cycling or mood preset map
    const colors = choices.map((_,i)=> zoneColors[i%zoneColors.length]);

    buildZones(choices, colors);

    questionEl.textContent = $('#qInput').value.trim() || 'Question of the Day';
    save('mxq_choices_v2', {q:questionEl.textContent, choices, colors});
    relabelBadges();
    updateStats();
  }

  function openEdit(){
    const saved = load('mxq_choices_v2');
    if(saved){
      $('#qInput').value = saved.q;
      $('#choicesInput').value = saved.choices.join('\n');
      $('#choiceCount').value = Math.min(4, Math.max(1, saved.choices.length));
      $('#openMode').checked = saved.choices.some(c=>/ready to explain/i.test(c));
    } else {
      $('#qInput').value = questionEl.textContent;
      $('#choicesInput').value = $$('.zone h3').map(h=>h.textContent.trim()).join('\n');
      $('#choiceCount').value = Math.min(4, $$('.zone').length);
      $('#openMode').checked = false;
    }
    $('#editModal').classList.add('show');
  }

  function applyRoster(){
    roster = $('#rosterInput').value.split(/\n+/).map(s=>s.trim()).filter(Boolean);
    save('mxq_roster', roster);
    makeBadges();
    showToast('Roster applied');
  }

  function makeBadges(){
    badges.forEach(b=>b.remove()); badges = [];
    const base = rect(parking); const appRect = rect(app);
    roster.forEach((name, idx)=>{
      const el = document.createElement('div'); el.className = 'badge';
      const num = document.createElement('span'); num.className = 'num'; num.textContent = String(idx+1);
      el.appendChild(num); el.appendChild(document.createTextNode(' '+name));
      app.appendChild(el);
      const x = base.left - appRect.left + 12 + (idx%4)*140;
      const y = (base.top - appRect.top) + 50 + Math.floor(idx/4)*56;
      el.style.left = x+'px'; el.style.top = y+'px'; el.dataset.zone = 'parking';
      enableDrag(el); badges.push(el);
    });
    updateStats();
  }

  function relabelBadges(){
    // ensure dataset.zone still maps to a valid zone index
    const zEls = $$('.zone');
    badges.forEach(b=>{ const c=center(b); let inAny=false; for(const z of zEls){ if(within(c,z)){ b.dataset.zone=z.dataset.zone; inAny=true; break; } } if(!inAny) b.dataset.zone='parking'; });
  }

  function updateStats(){
    const placed = badges.filter(b=>b.dataset.zone!=='parking');
    const absent = badges.length - placed.length;
    $('#statPlaced').textContent = 'Placed: '+placed.length;
    $('#statAbsent').textContent = 'Absent (not placed): '+absent;
    badges.forEach(b=>{ b.dataset.absent = (b.dataset.zone==='parking'); });
  }

  function enableDrag(el){
    el.addEventListener('pointerdown', (e)=>{ el.setPointerCapture(e.pointerId); const r=el.getBoundingClientRect(); drag={el,dx:e.clientX-r.left,dy:e.clientY-r.top}; });
    el.addEventListener('pointermove', (e)=>{ if(!drag||drag.el!==el) return; const appR=rect(app); const x=e.clientX-appR.left-drag.dx; const y=e.clientY-appR.top-drag.dy; el.style.left=x+"px"; el.style.top=y+"px"; });
    el.addEventListener('pointerup', ()=>{ if(!drag||drag.el!==el) return; settle(el); drag=null; });
  }

  function settle(el){
    const pt = center(el); const zEls = $$('.zone'); let zoned='parking';
    for(const z of zEls){ if(within(pt,z)){ zoned=z.dataset.zone; break; } }
    el.dataset.zone = zoned; updateStats();
  }

  function resetPositions(){
    const base = rect(parking); const appR = rect(app);
    badges.forEach((el, idx)=>{ const x=base.left-appR.left+12+(idx%4)*140; const y=(base.top-appR.top)+50+Math.floor(idx/4)*56; el.style.left=x+'px'; el.style.top=y+'px'; el.dataset.zone='parking'; });
    updateStats();
  }

  // --- Randomizer with spin + sounds (only from placed names) ---
  function randomPick(){
    let pool = badges.filter(b=>b.dataset.zone!=='parking');
    if(pool.length===0){ showToast('No placed names yet.'); return; }
    pool.forEach(b=>b.classList.remove('spinning','winner'));
    const rounds = Math.max(24, 6 + pool.length*2); const baseDelay=40; let i=0;
    function tick(){ try{ const ctx=new (window.AudioContext||window.webkitAudioContext)(); const o=ctx.createOscillator(), g=ctx.createGain(); o.type='square'; o.frequency.value=800+Math.random()*200; g.gain.setValueAtTime(0.08, ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.08); o.connect(g).connect(ctx.destination); o.start(); o.stop(ctx.currentTime+0.09); setTimeout(()=>ctx.close(),120);}catch(e){} }
    function win(){ try{ const ctx=new (window.AudioContext||window.webkitAudioContext)(); const o=ctx.createOscillator(), g=ctx.createGain(); o.type='triangle'; o.frequency.value=620; g.gain.setValueAtTime(0.001, ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.12, ctx.currentTime+0.02); g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.5); o.connect(g).connect(ctx.destination); o.start(); o.stop(ctx.currentTime+0.55); setTimeout(()=>ctx.close(),600);}catch(e){} }
    function step(){ pool.forEach(b=>b.classList.remove('spinning')); const idx=i%pool.length; pool[idx].classList.add('spinning'); tick(); i++; const p=i/rounds; const d=baseDelay+p*p*260; if(i<rounds){ setTimeout(step,d); } else { pool.forEach(b=>b.classList.remove('spinning','winner')); const winner=pool[(i-1)%pool.length]; winner.classList.add('winner'); win(); const z=winner.dataset.zone; let answer=''; const zEl=document.querySelector(`.zone[data-zone="${z}"] h3`); if(zEl) answer=zEl.textContent.trim(); const name=winner.textContent.trim(); $('#winnerText').textContent=name; $('#winnerSub').textContent=(answer? `${name}, please explain your answer: ${answer} ğŸ™‚` : `${name}, please explain your answer ğŸ™‚`); $('#winnerModal').classList.add('show'); } }
    step();
  }

  function saveLayout(){ const layout=badges.map(b=>({ name:b.textContent.trim(), left:b.style.left, top:b.style.top, zone:b.dataset.zone })); save('mxq_layout', layout); showToast('Layout saved'); }
  function loadLayout(){ const layout=load('mxq_layout'); if(!layout){ showToast('No saved layout found'); return; } const map=new Map(layout.map(x=>[x.name,x])); badges.forEach(b=>{ const rec=map.get(b.textContent.trim()); if(rec){ b.style.left=rec.left; b.style.top=rec.top; b.dataset.zone=rec.zone; } }); updateStats(); showToast('Layout loaded'); }

  // --- Question Generator (offline template-based, Grade 2, critical thinking) ---
  function generateQuestion(count, keywords){
    const kw = (keywords||'').trim();
    const topic = kw ? kw.toLowerCase() : null;
    const stems = [
      'Which choice would you pick and why?',
      'What do you notice and what do you wonder?',
      'How could you sort or group these ideas?',
      'What makes this choice the best for today?',
      'If you could change one thing, what would it be and why?'
    ];
    const baseQs = [
      `Let\'s think together about ${topic||'today'}. ${stems[Math.floor(Math.random()*stems.length)]}`,
      `Use your brain like a detective! ${topic?('About '+topic+', '):''}${stems[Math.floor(Math.random()*stems.length)]}`,
      `${topic?('Thinking about '+topic+', '):''}explain your thinking with because statements.`
    ];
    // Tailor to count
    const countHint = (count===1? 'There is one choice today.' : `There are ${count} choices today.`);
    return `${countHint} ${baseQs[Math.floor(Math.random()*baseQs.length)]}`;
  }

  // --- Presets ---
  function setMoodPreset(){
    questionEl.textContent = moodPreset.q;
    buildZones(moodPreset.choices, moodPreset.colors);
    save('mxq_choices_v2', {q:moodPreset.q, choices:moodPreset.choices, colors:moodPreset.colors});
    relabelBadges(); updateStats();
  }

  // --- Wire UI ---
  $('#editBtn').onclick = () => {
    const saved = load('mxq_choices_v2');
    if(saved){ $('#qInput').value = saved.q; $('#choicesInput').value = saved.choices.join('\n'); $('#choiceCount').value = Math.min(4, Math.max(1, saved.choices.length)); $('#openMode').checked = saved.choices.some(c=>/ready to explain/i.test(c)); }
    else { $('#qInput').value = questionEl.textContent; $('#choicesInput').value = $$('.zone h3').map(h=>h.textContent.trim()).join('\n'); $('#choiceCount').value = Math.min(4, $$('.zone').length); $('#openMode').checked=false; }
    $('#editModal').classList.add('show');
  };
  $('#applyEdit').onclick = ()=>{ applyChoices(); $('#editModal').classList.remove('show'); };
  $('#closeEdit').onclick = ()=>$('#editModal').classList.remove('show');

  $('#presetMood').onclick = setMoodPreset;

  $('#genBtn').onclick = ()=>{
    const saved = load('mxq_choices_v2');
    const count = saved? saved.choices.length : $$('.zone').length;
    const q = generateQuestion(count, $('#keywordInput').value);
    questionEl.textContent = q; save('mxq_choices_v2', { q, choices: (saved? saved.choices: $$('.zone h3').map(h=>h.textContent.trim())), colors: (saved? saved.colors: $$('.zone').map(z=>Array.from(z.classList).find(c=>['blue','red','green','purple','yellow'].includes(c))||'blue')) });
  };

  $('#randomBtn').onclick = randomPick;
  $('#resetBtn').onclick = resetPositions;
  $('#saveBtn').onclick = saveLayout;
  $('#loadBtn').onclick = loadLayout;
  $('#closeWinner').onclick = ()=>$('#winnerModal').classList.remove('show');

  // --- Init ---
  const savedQ = load('mxq_choices_v2');
  if(savedQ){ questionEl.textContent=savedQ.q; buildZones(savedQ.choices, savedQ.colors); }
  const savedRoster = load('mxq_roster');
  if(savedRoster){ roster = savedRoster; } else { roster = $('#rosterInput').value.split(/\n+/).map(s=>s.trim()).filter(Boolean); }
  makeBadges();
  updateStats();
})();
</script>
</body>
</html>